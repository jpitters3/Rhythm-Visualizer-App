/* ===== LABELS + GRID ===== */
.labels {
  display: grid;
  grid-template-columns: repeat(var(--cols, 8), 1fr);
  gap: 12px;
  margin-bottom: 12px;
  max-width: 900px;
  font-size: 24px;
  font-weight: 500;
  opacity: 0.8;
  text-align: center;
}

.grid {
  display: grid;
  grid-template-columns: repeat(var(--cols, 8), 1fr);
  gap: 12px;
  max-width: 900px;
}

.cell {
  width: 100%;
  padding-top: 100%;
  border-radius: 50%;
  background: var(--cell-bg);
  border: 2px solid var(--cell-border);
  cursor: pointer;
  transition: background 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
  position: relative;
  user-select: none;
  overflow: hidden; /* keeps half-fills clean */
}

/* ===== PLAY EXPAND (NO LAYOUT SHIFT) ===== */
/* Transform-based animation so other beats never move */
.cell {
  transform: translateZ(0) scale(1);
  transition: transform 250ms ease;
  will-change: transform;
}

/* Expand only when playing AND not a ghost note */
.cell.play:not(.ghost) {
  transform: translateZ(0) scale(1.2);
}

/* Never expand ghost notes */
.cell.ghost.play {
  transform: translateZ(0) scale(1);
}

.cell .inner {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 650;
  font-size: 36px;
  letter-spacing: 0.5px;
  opacity: 0.95;
  pointer-events: none;
  color: var(--text);
}

/* ===== MULTI-MEASURE WRAP ===== */
.measures {
  max-width: 900px;
}

/* One measure = (labels row + grid row) + a + button column */
.measure {
  display: grid;
  grid-template-columns: repeat(var(--cols, 8), 1fr) auto;
  grid-template-rows: auto auto;
  gap: 12px;
  margin-bottom: 16px;
  align-items: center;
}

/* Weâ€™ll render label cells + grid cells directly inside the measure grid */
.labelCell {
  text-align: center;
  font-size: 24px;
  font-weight: 500;
  opacity: 0.8;
}

.gridCell {
  grid-row: 2;
}

/* + button sits to the right of the last beat and spans both rows */
.add-measure {
  grid-column: calc(var(--cols, 8) + 1);
  grid-row: 1 / span 2;
  width: 46px;
  height: 46px;
  padding: 0;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  line-height: 1;
  font-weight: 700;
  background: var(--btn-bg);
  border: 1px solid var(--panel-border);
}

.add-measure:hover { filter: brightness(1.03); }

@media (max-width: 600px) {
  .labelCell { font-size: 18px; }
  .add-measure { width: 40px; height: 40px; font-size: 24px; }
}


/* Selection ring */
.cell.selected {
  border-color: rgba(234, 234, 240, 0.9);
  box-shadow: 0 0 0 6px rgba(234, 234, 240, 0.12);
}
body:not(.dark) .cell.selected {
  border-color: rgba(47, 47, 47, 0.85);
  box-shadow: 0 0 0 6px rgba(47, 47, 47, 0.12);
}

/* Play ring */
.cell.play { box-shadow: 0 0 0 6px var(--play-glow); }
body:not(.dark) .cell.play { box-shadow: 0 0 0 6px rgba(47, 47, 47, 0.35); }

/* ON highlight only when unlabeled */
.cell.on:not(.label-d):not(.label-t):not(.label-s):not(.label-n) { background: var(--cell-on); }

/* ===== BEAT POSITION COLOR (Downbeat/Upbeat) ===== */

/* Two colors only */
:root {
    --down-fill: #610a42; /* blue */
    --up-fill: rgb(2, 68, 150);   /* yellow */
}
body.dark {
    --down-fill: #fd0380; /* keep gold in dark mode too */
    --up-fill: rgb(30, 121, 232);   /* slightly softer green for dark */
}

/* Mixing strength (keeps your nice subtle fill) */
.cell.has-label { --mix: 42%; }
.cell.on.has-label { --mix: 70%; }

/* Choose fill based on beat position */
.cell.downbeat { --beat-fill: var(--down-fill); }
.cell.upbeat { --beat-fill: var(--up-fill); }

/* Inner label color by beat type */
.cell.has-label.downbeat .inner {
    color: var(--down-fill); /* black text on gold */
}

.cell.has-label.upbeat .inner {
    color: var(--up-fill); /* text */
}

/* ON highlight only when unlabeled */
.cell.on:not(.has-label) { background: var(--cell-on); }

body.handSplit .cell.has-label {
   background: color-mix(in srgb, var(--beat-fill) var(--mix), var(--cell-bg));
}

/* Split mode OFF: fill whole circle */
body:not(.handSplit) .cell.has-label {
    background: color-mix(in srgb, var(--beat-fill) var(--mix), var(--cell-bg));
    background: color-mix(in srgb, var(--beat-fill) var(--mix), var(--cell-bg));

}

/* ===== GHOST NOTE DOT (default when no inner label) ===== */
.cell .ghost-dot {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 12px;
    height: 12px;
    border-radius: 999px;
    transform: translate(-50%, -50%);
    pointer-events: none;

    /* Match the color the fill WOULD be (downbeat/upbeat) */
    background: var(--beat-fill);

    /* A little softness for video readability */
    opacity: 0.75;
    box-shadow: 0 0 0 4px rgba(0,0,0,0.06);
}

/* Hide dot once a label is set */
.cell.has-label .ghost-dot {
    display: none;
}