<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rhythm Visualizer — Hand Icons v1.17.4</title>

  <style>
    .footer {
      margin-top: 18px;
      font-size: 13px;
      opacity: 0.6;
    }

    div.container {
        margin: 0 auto;
        width: 98%;
        max-width: 1200px;
    }
  </style>
  <link rel="stylesheet" href="./css/controls.css">
  <link rel="stylesheet" href="./css/theme.css">
  <link rel="stylesheet" href="./css/grid-and-labels.css">
  <link rel="stylesheet" href="./css/hand-icons.css">
  <link rel="stylesheet" href="./css/legend.css">
  <link rel="stylesheet" href="./css/groove-modal.css">
  <link rel="stylesheet" href="./css/presentation-mode.css">
  <link rel="stylesheet" href="./css/handpanmap.css">
</head>
<body>

  <h2>Simple Rhythm / Groove Visualizer <span style="opacity:.5;font-size:14px;">v1.17.4</span></h2>
  <div class="container">
    <!-- Pattern management row -->
    <div class="pattern-row">
      <button id="accountBtn" title="Sign in / out">Account</button>
      <span id="accountStatus" style="opacity:.75;font-size:13px;"></span>
      <select id="patternSelect" title="Saved patterns">
        <option value="">(no saved patterns)</option>
        </select>
        <button id="saveBtn" title="Save current pattern">Save</button>
        <button id="loadBtn" title="Load selected pattern">Load</button>
        <button id="renameBtn" title="Rename selected pattern">Rename</button>
        <button id="deleteBtn" title="Delete selected pattern">Delete</button>
        <button id="exportBtn" title="Copy pattern JSON to clipboard">Export</button>
        <button id="importBtn" title="Paste JSON to load a pattern">Import</button>
    </div>

    <div class="controls">
        <button id="themeBtn" title="Toggle light / dark mode">☀︎ / ☾</button>
        <button id="playBtn">Play</button>
        <button id="grooveBtn" title="Generate a random groove">Give me a groove!</button>
        <button id="metroBtn" title="Toggle metronome click">Metronome: Off</button>
        <button id="composeBtn" title="Compose mode: writing advances to the next beat (Alt = write without advance)">
          Compose: Off
        </button>        
        <button id="gridBtn" title="Toggle between 8th and 16th grid">8ths</button>
        <button id="handBtn" class="active" title="Toggle left/right hand coloring">Left/Right: Off</button>
        <button id="presentBtn" title="Toggle presentation mode (Esc exits)">Presentation</button>
        <button id="calBtn" title="Toggle handpan calibration">Calibrate Map</button>


        <label>
        BPM
        <input id="bpm" type="range" min="40" max="200" value="90" />
        </label>
        <span id="bpmVal">90</span>
        <button id="clearBtn">Clear</button>
    </div>
    <div class="main">
      <div class="left">
        <div id="measures" class="measures" aria-label="Rhythm grid"></div>
      </div>
    
      <aside class="handpan-panel" aria-label="Handpan map">
        <select id="scaleSelect" title="Choose your handpan scale"></select>
        <span id="scaleStatus" style="opacity:.7;font-size:13px;"></span>
        <div class="handpan-wrap" id="handpanWrap">
          <img
            src="./assets/images/nine-note-handpan-numbered.png"
            alt="Handpan note layout"
            class="handpan-img"
          />
          <div class="handpan-overlay" id="handpanOverlay"></div>
        </div>
      </aside>
    </div>
  </div><!-- container -->

  <div class="legend" aria-label="Legend">
      <div class="legend-title">Legend</div>
      <div class="legend-row">
      <span><kbd>Space</kbd> Play / Stop</span>
      <span><kbd>D</kbd> Ding</span>
      <span><kbd>T</kbd> Tone</span>
      <span><kbd>S</kbd> Slap</span>
      <span><kbd>0–9</kbd> Digit</span>
      <span><kbd>Left/Right</kbd> Toggle hand split</span>
      <span><kbd>Click</kbd> Toggle on/off</span>
      <span><kbd>Click</kbd> Select</span>
      <span><kbd>M</kbd> Toggle metronome</span>
      <span><kbd>Esc</kbd> Unselect / Exit Presentation</span>
      </div>
  </div>
  

  <div class="footer"></div>

  <button id="exitPresent" class="present-exit" title="Exit presentation mode (Esc)">Exit</button>

  <!-- Groove Generator Modal -->
  <div id="grooveModal" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-title">Give me a groove!</div>
      <div class="modal-subtitle">Choose accents, or leave as Auto and hit Go.</div>

      <select id="complexitySelect" title="Groove complexity">
        <option value="1" selected>Simple</option>
        <option value="2">Groovy</option>
        <option value="3">Wild</option>
        <option value="R">Completely Random</option>
      </select>
      
      <div class="modal-grid">
        <label class="modal-row">
          <span>Ding accents</span>
          <input id="dingCount" type="number" min="0" max="8" placeholder="Auto" />
        </label>

        <label class="modal-row">
          <span>Tak accents</span>
          <input id="takCount" type="number" min="0" max="8" placeholder="Auto" />
        </label>

        <label class="modal-row">
          <span>Slap accents</span>
          <input id="slapCount" type="number" min="0" max="8" placeholder="Auto" />
        </label>
      </div>

      <div class="modal-hint" id="grooveHint"></div>

      <div class="modal-actions">
        <button id="grooveCancel">Cancel</button>
        <button id="grooveGo" class="active">Go!</button>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Account">
      <div class="modal-title">Account</div>
      <div class="modal-subtitle">Sign in to save grooves to the cloud.</div>
  
      <div class="modal-grid">
        <label class="modal-row">
          <span>Email</span>
          <input id="authEmail" type="email" autocomplete="email" placeholder="you@example.com" style="width:200px;padding:10px 12px;border-radius:999px;border:1px solid var(--panel-border);background:var(--panel);color:var(--text);" />
        </label>
  
        <label class="modal-row">
          <span>Password</span>
          <input id="authPass" type="password" autocomplete="current-password" placeholder="••••••••" style="width:200px;padding:10px 12px;border-radius:999px;border:1px solid var(--panel-border);background:var(--panel);color:var(--text);" />
        </label>
      </div>
  
      <div class="modal-hint" id="authHint">Tip: Use Register once, then Sign in.</div>
  
      <div class="modal-actions">
        <button id="authCancel">Cancel</button>
        <button id="authRegister">Register</button>
        <button id="authLogin" class="active">Sign in</button>
        <button id="authLogout" style="display:none;">Sign out</button>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ycdlqkaymkgpbpgtqubs.supabase.co";
    const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_ibxUdXTNfhXKhE5sh0wezA_1kigLLAZ";

    window.supabase1 = window.supabase1 || window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_PUBLISHABLE_KEY,
      {
        auth: {
          persistSession: true,
          autoRefreshToken: true,
          detectSessionInUrl: true,
          storage: window.localStorage,
        },
      }
    );

    const supabase1 = window.supabase1;

    let currentUser = null;

    // ===== CONFIG =====
    const VERSION = 'v1.17.4 — Cleaner Hand Silhouette + Fix Right Position';

    // Modes:
    // - '8'  => 8 steps (eighth notes): 1 + 2 + 3 + 4 +
    // - '16' => 16 steps (sixteenth notes): 1 e & a ...
    let mode = '8';
    let STEPS = 8;

    // ===== STORAGE KEYS =====
    const STORAGE_KEY = 'rhythm_visualizer_patterns_v1';
    const LAST_USED_KEY = 'rhythm_visualizer_last_used';
    const PRESENT_KEY = 'rhythm_visualizer_present';
    const METRO_KEY = 'rhythm_visualizer_metronome';


    // ===== ELEMENTS =====
    const measuresEl = document.getElementById('measures');
    const playBtn = document.getElementById('playBtn');
    const metroBtn = document.getElementById('metroBtn');
    const hpBtn = document.getElementById('hpBtn');
    const gridBtn = document.getElementById('gridBtn');
    const bpmInput = document.getElementById('bpm');
    const bpmVal = document.getElementById('bpmVal');
    const clearBtn = document.getElementById('clearBtn');
    const themeBtn = document.getElementById('themeBtn');
    const handBtn = document.getElementById('handBtn');
    const presentBtn = document.getElementById('presentBtn');
    const exitPresent = document.getElementById('exitPresent');

    const patternSelect = document.getElementById('patternSelect');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const renameBtn = document.getElementById('renameBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');

    // ===== GROOVE MODAL ELEMENTS =====
    const grooveBtn = document.getElementById('grooveBtn');
    const grooveModal = document.getElementById('grooveModal');
    const grooveCancel = document.getElementById('grooveCancel');
    const grooveGo = document.getElementById('grooveGo');
    const dingCount = document.getElementById('dingCount');
    const takCount = document.getElementById('takCount');
    const slapCount = document.getElementById('slapCount');
    const grooveHint = document.getElementById('grooveHint');
    const complexitySelect = document.getElementById('complexitySelect');

    // ===== AUTH ELEMENTS =====
    const accountBtn = document.getElementById('accountBtn');
    const accountStatus = document.getElementById('accountStatus');

    const authModal = document.getElementById('authModal');
    const authCancel = document.getElementById('authCancel');
    const authRegister = document.getElementById('authRegister');
    const authLogin = document.getElementById('authLogin');
    const authLogout = document.getElementById('authLogout');
    const authEmail = document.getElementById('authEmail');
    const authPass = document.getElementById('authPass');
    const authHint = document.getElementById('authHint');

    const ADMIN_EMAILS = new Set([
      "jpitters3@gmail.com",
    ]);

    


    // ===== STATE =====
    let innerLabels = [];
    let selectedIndex = null;
    let measures = 1;

    
  </script>
  <script src="./js/notegrid.js"></script>
  <script src="./js/noteplayer.js"></script>
  <script src="./js/handpanmap.js"></script>
  <script src="./js/compose-mode.js"></script>
  <script src="./js/groove-generator.js"></script>
  <script src="./js/presentation-mode.js"></script>
  <script src="./js/pattern-crud.js"></script>
  <script src="./js/controls.js"></script>
  <script src="./js/keyboard-shortcuts.js"></script>
  <script src="./js/auth.js"></script>
  <script src="./js/init.js"></script><!-- keep near bottom -->
</body>
</html>
